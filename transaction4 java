
    private static void executeTransaction4(Connection connection, JTextArea textArea) throws SQLException {
        // Add logic for Transaction 4
       
        try {
        // Step 1: Show Existing Order IDs in a Dropdown
        String orderQuery = "SELECT OrderID FROM Orders";
        PreparedStatement orderStmt = connection.prepareStatement(orderQuery);
        ResultSet orderResult = orderStmt.executeQuery();

        JComboBox<String> orderComboBox = new JComboBox<>();
        while (orderResult.next()) {
            String orderId = orderResult.getString("OrderID");
            orderComboBox.addItem(orderId);
        }

        int orderSelection = JOptionPane.showConfirmDialog(
                null,
                orderComboBox,
                "Select Order ID",
                JOptionPane.OK_CANCEL_OPTION
        );

        if (orderSelection != JOptionPane.OK_OPTION) {
            textArea.setText("Operation canceled.\n");
            return;
        }

        String selectedOrderId = (String) orderComboBox.getSelectedItem();

        // Step 2: Prompt the User to Choose the Order Status
        Object[] options = {"Cancel Order", "Mark as Delivered"};
        int statusSelection = JOptionPane.showOptionDialog(
                null,
                "What would you like to do with Order ID: " + selectedOrderId + "?",
                "Update Order Status",
                JOptionPane.YES_NO_OPTION,
                JOptionPane.QUESTION_MESSAGE,
                null,
                options,
                options[0]
        );

        if (statusSelection == JOptionPane.CLOSED_OPTION) {
            textArea.setText("No action taken for Order ID: " + selectedOrderId + ".\n");
            return;
        }

        String newStatus;
        if (statusSelection == 0) { // Cancel Order
            newStatus = "Cancelled";
        } else { // Mark as Delivered
            newStatus = "Delivered";
        }

        // Step 3: Update the Order Status in the Database
        String updateStatusQuery = "UPDATE Orders SET OrderStatus = ? WHERE OrderID = ?";
        PreparedStatement updateStatusStmt = connection.prepareStatement(updateStatusQuery);
        updateStatusStmt.setString(1, newStatus);
        updateStatusStmt.setString(2, selectedOrderId);

        int rowsUpdated = updateStatusStmt.executeUpdate();
        textArea.setText("Transaction 4: Complete Customer Purchase executed.\n");
        if (rowsUpdated > 0) {
            textArea.append("Order ID " + selectedOrderId + " has been updated to status: " + newStatus + ".\n");

            // Step 4: Update Product Stock if Marked as Delivered
            if ("Delivered".equalsIgnoreCase(newStatus)) {
                String orderLineQuery = "SELECT ProductID, QuantityOrder FROM OrderLine WHERE OrderID = ?";
                PreparedStatement orderLineStmt = connection.prepareStatement(orderLineQuery);
                orderLineStmt.setString(1, selectedOrderId);

                ResultSet orderLineResult = orderLineStmt.executeQuery();

                while (orderLineResult.next()) {
                    String productId = orderLineResult.getString("ProductID");
                    int orderedQuantity = orderLineResult.getInt("QuantityOrder");

                    // Update the product stock by subtracting the ordered quantity
                    String updateStockQuery = "UPDATE Products SET QuantityInStock = QuantityInStock - ? WHERE ProductID = ?";
                    PreparedStatement updateStockStmt = connection.prepareStatement(updateStockQuery);
                    updateStockStmt.setInt(1, orderedQuantity);
                    updateStockStmt.setString(2, productId);

                    int stockUpdated = updateStockStmt.executeUpdate();
                    if (stockUpdated > 0) {
                        textArea.append("Product ID " + productId + " stock updated. Reduced by " + orderedQuantity + " units.\n");
                    } else {
                        textArea.append("Failed to update stock for Product ID: " + productId + ".\n");
                    }
                }
            }
        } else {
            textArea.append("Failed to update status for Order ID: " + selectedOrderId + ".\n");
        }
    } catch (SQLException ex) {
        textArea.append("Error updating order status or product stock: " + ex.getMessage() + "\n");
    }  
    
    }
    
